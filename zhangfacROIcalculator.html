<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå•†ROIè®¡ç®—å·¥å…· (Proç‰ˆ) - å¼ å‘è´¢çš„èµ„æ–™åº“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap');
        
        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            background-color: #f3f4f6;
        }

        /* éšè—æ•°å­—è¾“å…¥æ¡†çš„ç®­å¤´ */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* åŠ¨æ€æ¡å½¢å›¾åŠ¨ç”» */
        .bar-segment {
            transition: width 0.5s ease-in-out;
        }
        
        .floating-label-input:focus-within label {
            color: #007BFF;
        }

        /* å‘è´¢ç‰¹è‰²å¼ºè°ƒè‰² - ä¸»è‰²è°ƒå®šä¹‰ */
        .facai-blue { color: #007BFF; }
        .bg-facai-blue { background-color: #007BFF; }
        .border-facai-blue { border-color: #007BFF; }
        .ring-facai-blue { --tw-ring-color: #007BFF; }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col font-sans">

    <!-- é¡¶éƒ¨å¯¼èˆª - ä½¿ç”¨è‡ªå®šä¹‰è“è‰² #007BFF -->
    <header class="bg-[#007BFF] text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 bg-white text-[#007BFF] rounded-lg transform -rotate-3 flex items-center justify-center font-black text-xl shadow-md border-2 border-yellow-400">è´¢</div>
                <div>
                    <h1 class="text-lg md:text-xl font-bold tracking-wide">ROIè®¡ç®—ç½—ç›˜ <span class="text-xs bg-blue-800 px-1.5 py-0.5 rounded text-blue-100 ml-1 font-normal">v3.4 ç†æ€§ç‰ˆ</span></h1>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <a href="https://zhangfac-888.github.io/utility-box/zhangfacrlh.html" target="_blank" class="text-sm bg-yellow-400 hover:bg-yellow-300 text-blue-900 font-bold px-3 py-1.5 rounded transition flex items-center gap-2 shadow-md">
                    <i class="fas fa-book-open"></i> <span class="hidden sm:inline">å¼ å‘è´¢çš„èµ„æ–™åº“</span>
                </a>
                <!-- é‡ç½®æŒ‰é’®é¢œè‰²è°ƒæ•´ä¸ºæ·±è“ï¼Œé€‚é…èƒŒæ™¯ -->
                <button onclick="resetForm()" class="text-sm bg-blue-700 hover:bg-blue-600 px-3 py-1.5 rounded transition flex items-center gap-2 border border-blue-600">
                    <i class="fas fa-rotate-right"></i> <span class="hidden sm:inline">æ¸…ç©ºé‡æ¥</span>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-6 max-w-6xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- å·¦ä¾§ï¼šè¾“å…¥åŒºåŸŸ (å 8åˆ—) -->
        <div class="lg:col-span-8 space-y-6">
            
            <!-- 1. æµé‡ä¸è½¬åŒ–æ•°æ® -->
            <div class="bg-white rounded-xl card-shadow overflow-hidden group hover:shadow-lg transition-shadow">
                <div class="bg-blue-50 border-b border-blue-100 px-6 py-3 flex items-center gap-2">
                    <i class="fas fa-bullhorn text-[#007BFF]"></i>
                    <h2 class="font-bold text-gray-800">æµé‡ä¸æŠ•æ”¾æ•°æ®</h2>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">æ¨å¹¿èŠ±è´¹ (å…ƒ)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400">Â¥</span>
                            <input type="number" id="adCost" value="1000" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#007BFF] focus:border-[#007BFF] outline-none transition font-mono font-medium bg-gray-50 focus:bg-white" oninput="calc()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">æ¨å¹¿æˆäº¤é¢ GMV (å…ƒ)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400">Â¥</span>
                            <input type="number" id="adGmv" value="2590" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#007BFF] focus:border-[#007BFF] outline-none transition font-mono font-medium bg-gray-50 focus:bg-white" oninput="calc()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">å•æ¬¡ç‚¹å‡»æˆæœ¬ PPC (å…ƒ)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400">Â¥</span>
                            <input type="number" id="ppc" value="1.2" step="0.01" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#007BFF] focus:border-[#007BFF] outline-none transition font-mono bg-gray-50 focus:bg-white" oninput="calc()">
                        </div>
                    </div>
                     <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">å¹³å‡å®¢å•ä»· (å…ƒ)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400">Â¥</span>
                            <input type="number" id="avgTicket" value="35" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-[#007BFF] focus:border-[#007BFF] outline-none transition font-mono bg-gray-50 focus:bg-white" oninput="calc()">
                        </div>
                    </div>
                </div>
                <!-- å®æ—¶å°è®¡ -->
                <div class="bg-blue-50 px-6 py-2 flex justify-between items-center text-sm border-t border-blue-100">
                    <span class="text-[#007BFF] font-medium">å½“å‰è¡¨é¢æŠ•äº§æ¯” (ROI)</span>
                    <span class="font-bold text-[#007BFF] font-mono text-lg" id="miniRoiDisplay">2.59</span>
                </div>
            </div>

            <!-- 2. äº§å“ä¸æˆæœ¬æ•°æ® -->
            <div class="bg-white rounded-xl card-shadow overflow-hidden group hover:shadow-lg transition-shadow">
                <div class="bg-gray-50 border-b border-gray-100 px-6 py-3 flex items-center gap-2">
                    <i class="fas fa-file-invoice-dollar text-gray-500"></i>
                    <h2 class="font-bold text-gray-800">æˆæœ¬ç»“æ„ (åˆ«éª—è‡ªå·±)</h2>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">äº§å“å”®ä»· (å…ƒ)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400">Â¥</span>
                            <input type="number" id="sellingPrice" value="29" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition font-mono font-medium bg-gray-50 focus:bg-white" oninput="calc()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">æ‹¿è´§/ç”Ÿäº§æˆæœ¬ (å…ƒ)</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2.5 text-gray-400">Â¥</span>
                            <input type="number" id="productCost" value="8" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition font-mono bg-gray-50 focus:bg-white" oninput="calc()">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">å¹³å°æ‰£ç‚¹ (%)</label>
                        <div class="relative">
                            <input type="number" id="platformFeeRate" value="0.5" step="0.1" class="w-full pl-3 pr-8 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition font-mono bg-gray-50 focus:bg-white" oninput="calc()">
                            <span class="absolute right-3 top-2.5 text-gray-400">%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">é¢„ä¼°é€€æ¬¾ç‡ (%)</label>
                        <div class="relative">
                            <input type="number" id="refundRate" value="6.3" step="0.1" class="w-full pl-3 pr-8 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none transition font-mono bg-gray-50 focus:bg-white" oninput="calc()">
                            <span class="absolute right-3 top-2.5 text-gray-400">%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å¯è§†åŒ–æ¡å½¢å›¾ -->
             <div class="bg-white rounded-xl card-shadow p-6">
                <h3 class="font-bold text-gray-700 mb-4 flex justify-between items-center">
                    <span>èµ„é‡‘è¢«è°åƒæ‰äº†ï¼Ÿ</span>
                    <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded">åŸºäºå½“å‰GMVæ‹†è§£</span>
                </h3>
                
                <!-- æ¡å½¢å›¾å®¹å™¨ -->
                <div class="h-10 w-full bg-gray-100 rounded-lg overflow-hidden flex text-xs text-white font-bold leading-10 mb-2 shadow-inner">
                    <div id="barCost" class="bar-segment bg-slate-400 text-center border-r border-white/20" style="width: 30%">æˆæœ¬</div>
                    <div id="barFee" class="bar-segment bg-orange-400 text-center border-r border-white/20" style="width: 5%">æŸè€—</div>
                    <!-- å¹¿å‘Šéƒ¨åˆ†æ¢æˆä¸»è‰²è°ƒ -->
                    <div id="barAd" class="bar-segment bg-[#007BFF] text-center border-r border-white/20" style="width: 40%">å¹¿å‘Š</div>
                    <div id="barProfit" class="bar-segment bg-green-500 text-center" style="width: 25%">åˆ©</div>
                </div>
                
                <div class="flex justify-between text-xs text-gray-500 mt-2 px-1">
                    <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-slate-400"></div> è´§å“æˆæœ¬</div>
                    <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-orange-400"></div> å¹³å°/é€€æ¬¾</div>
                    <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-[#007BFF]"></div> æ¨å¹¿èŠ±è´¹</div>
                    <div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-green-500"></div> å‡€åˆ©æ¶¦</div>
                </div>
            </div>

        </div>

        <!-- å³ä¾§ï¼šç»“æœé¢æ¿ (PCç«¯ Sticky, ç§»åŠ¨ç«¯å †å ) -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- å‘è´¢æ¯’èˆŒè¯­å½• (éšæœºç”Ÿæˆ) -->
            <div class="bg-yellow-50 rounded-xl p-5 border border-yellow-200 shadow-sm relative overflow-hidden">
                <i class="fas fa-quote-left absolute top-3 left-3 text-yellow-200 text-4xl -z-0"></i>
                <div class="relative z-10">
                    <h4 class="font-bold text-yellow-800 text-sm mb-2 flex items-center gap-2">
                        <span class="bg-yellow-500 text-white px-1.5 rounded text-xs">æ¯’èˆŒ</span> å¼ å‘è´¢è¯´ï¼š
                    </h4>
                    <p class="text-slate-800 font-medium text-sm italic leading-relaxed" id="facaiQuote">
                        <!-- JS éšæœºå¡«å…… -->
                        åŠ è½½ä¸­...
                    </p>
                </div>
            </div>

            <!-- æ ¸å¿ƒç»“æœå¡ç‰‡ - é¡¶éƒ¨è¾¹æ¡†æ¢æˆä¸»è‰²è°ƒ -->
            <div class="bg-white rounded-xl card-shadow border-t-4 border-[#007BFF] sticky top-20">
                <div class="p-6">
                    <h2 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2 flex justify-between items-center">
                        <span>æœ€ç»ˆåˆ†æ</span>
                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full">å«é€€æ¬¾æŸè€—</span>
                    </h2>
                    
                    <!-- å‡€åˆ©æ¶¦å±•ç¤º -->
                    <div class="text-center mb-6">
                        <p class="text-sm text-gray-500 mb-1">åˆ°åº•èµšäº†å¤šå°‘é’±ï¼Ÿ</p>
                        <div class="flex items-baseline justify-center gap-1" id="profitWrapper">
                            <span class="text-4xl font-black tracking-tight text-green-600" id="netProfit">Â¥ 0.00</span>
                        </div>
                        <div class="text-xs font-bold bg-gray-100 inline-block px-2 py-0.5 rounded mt-2 text-gray-600" id="profitRate">å‡€åˆ©ç‡: 0%</div>
                    </div>

                    <!-- æ ¸å¿ƒæŒ‡æ ‡ç½‘æ ¼ -->
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <!-- å®é™…ROI æ•°å­—æ¢æˆä¸»è‰²è°ƒ -->
                        <div class="bg-blue-50 p-3 rounded border border-blue-100">
                            <div class="text-[10px] text-gray-500 uppercase tracking-wide">å®é™… ROI</div>
                            <div class="font-bold text-[#007BFF] text-lg" id="realRoi">0.00</div>
                        </div>
                        <div class="bg-orange-50 p-3 rounded border border-orange-100">
                            <div class="text-[10px] text-gray-500 uppercase tracking-wide">ç”Ÿæ­»çº¿ ROI</div>
                            <div class="font-bold text-orange-700 text-lg" id="breakEvenRoi">0.00</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded text-center">
                            <div class="text-[10px] text-gray-500">æ¯›åˆ©ç‡</div>
                            <div class="font-bold text-gray-700" id="grossMargin">0%</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded text-center">
                            <div class="text-[10px] text-gray-500">ä¿æœ¬è½¬åŒ–ç‡</div>
                            <div class="font-bold text-gray-700" id="beConvRate">0%</div>
                        </div>
                    </div>

                    <!-- çŠ¶æ€åˆ¤å®š (å‘è´¢ç‚¹è¯„) -->
                    <div id="statusAlert" class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg text-sm font-medium flex items-start gap-3 mb-4">
                        <i class="fas fa-check-circle mt-0.5 text-lg"></i>
                        <span class="leading-snug">ä¸é”™ï¼Œæ˜¯èµšé’±çš„ã€‚ä½†åˆ«éª„å‚²ï¼Œå¹³å°è§„åˆ™å˜ä¸€å˜å¯èƒ½å°±æ²¡äº†ã€‚</span>
                    </div>

                    <!-- å¤åˆ¶æŒ‰é’®æ¢æˆä¸»è‰²è°ƒ -->
                    <button onclick="copyReport()" class="w-full bg-[#007BFF] hover:bg-blue-600 text-white font-bold py-3 rounded-lg transition shadow-lg active:transform active:scale-95 flex justify-center items-center gap-2 group">
                        <i class="fas fa-copy group-hover:animate-bounce"></i> å¤åˆ¶æˆ˜æŠ¥ (æ‹¿å»å¤ç›˜)
                    </button>
                </div>
            </div>

            <!-- æ·±åº¦è¯Šæ–­å»ºè®® -->
            <div class="bg-white rounded-xl card-shadow overflow-hidden">
                <div class="bg-slate-800 px-5 py-3 flex items-center gap-2">
                    <i class="fas fa-user-doctor text-yellow-400"></i>
                    <h2 class="font-bold text-white text-sm">å‘è´¢çš„æ¯’èˆŒè¯Šæ–­</h2>
                </div>
                <div class="p-5 text-sm space-y-3 bg-slate-50" id="diagnosisBox">
                    <!-- åŠ¨æ€å†…å®¹ -->
                </div>
            </div>
            
             <!-- ç‰ˆæƒFooter -->
            <div class="text-center mt-8 pb-4">
                <p class="text-xs text-gray-400 font-medium">Powered by å¼ å‘è´¢çš„èµ„æ–™åº“ 3.4</p>
                <p class="text-[10px] text-gray-300 mt-1">è®©è¿è¥æˆé•¿æœ‰è¿¹å¯å¾ª</p>
            </div>

        </div>

    </main>

    <!-- åº•éƒ¨Toastæç¤º -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded shadow-2xl transition-all duration-300 opacity-0 translate-y-10 pointer-events-none z-50 flex items-center gap-2">
        <i class="fas fa-check text-green-400"></i> <span>å·²å¤åˆ¶ï¼æ•°æ®ä¸ä¼šéª—äººã€‚</span>
    </div>

    <script>
        // å‘è´¢è¯­å½•åº“
        const quotes = [
            "æ„ŸåŠ¨è‡ªå·±æ²¡ç”¨ï¼Œæ•°æ®ä¸ä¼šé™ªä½ æ¼”æˆã€‚",
            "äºæŸçš„å”¯ä¸€åŸå› å°±æ˜¯ï¼šä½ ä»¥ä¸ºä½ çš„å“å¾ˆå¥½ã€‚",
            "åˆ«ç”¨æˆ˜æœ¯ä¸Šçš„å‹¤å¥‹ï¼Œæ©ç›–æˆ˜ç•¥ä¸Šçš„æ‡’æƒ°ã€‚",
            "åšç”µå•†ï¼Œä¸ç®—ç»†è´¦å°±æ˜¯åšæ…ˆå–„ã€‚",
            "é”€é‡æ˜¯é¢å­ï¼Œåˆ©æ¶¦æ‰æ˜¯é‡Œå­ã€‚åˆ«åªè¦é¢å­ä¸è¦é‡Œå­ã€‚",
            "ä¸€åˆ‡ä¸ä»¥åˆ©æ¶¦ä¸ºç›®çš„çš„æŠ•æ”¾ï¼Œéƒ½æ˜¯è€æµæ°“ã€‚",
            "ç‚¹å‡»ç‡ä½å°±æ˜¯å›¾ä¸è¡Œï¼Œåˆ«æ€ªæµé‡ä¸ç²¾å‡†ã€‚",
            "ä»»ä½•ç”Ÿæ„çš„æœ¬è´¨éƒ½æ˜¯æµé‡æˆæœ¬çš„å¥—åˆ©ã€‚",
            "ä¿æœ¬ROIéƒ½æ²¡ç®—æ¸…æ¥šï¼Œä½ æŠ•ä»€ä¹ˆå¹¿å‘Šï¼Ÿ",
            "å¦‚æœä½ çš„äº§å“æ²¡æœ‰å¤è´­ï¼Œé‚£ä½ æ°¸è¿œåœ¨ç»™å¹³å°æ‰“å·¥ã€‚"
        ];

        // éšæœºå±•ç¤ºè¯­å½•
        function setRandomQuote() {
            const idx = Math.floor(Math.random() * quotes.length);
            document.getElementById('facaiQuote').innerText = quotes[idx];
        }

        const get = (id) => parseFloat(document.getElementById(id).value) || 0;
        const setHtml = (id, val) => document.getElementById(id).innerHTML = val;
        
        function calc() {
            // 1. è·å–è¾“å…¥
            const adCost = get('adCost');
            const adGmv = get('adGmv');
            const ppc = get('ppc');
            const avgTicket = get('avgTicket');
            
            const sellingPrice = get('sellingPrice');
            const productCost = get('productCost');
            const platformFeeRate = get('platformFeeRate');
            const refundRate = get('refundRate');

            // 2. æ ¸å¿ƒè®¡ç®—
            const realRoi = adCost > 0 ? adGmv / adCost : 0;
            
            // å¹³å°æ‰£ç‚¹é‡‘é¢
            const platformFeeAmt = sellingPrice * (platformFeeRate / 100);
            // å•å“æ¯›åˆ©é‡‘é¢ (ä¸å«å¹¿å‘Š)
            const marginAmt = sellingPrice - productCost - platformFeeAmt;
            // æ¯›åˆ©ç‡
            const grossMarginRaw = sellingPrice > 0 ? marginAmt / sellingPrice : 0;
            
            // ä¿æœ¬ROI(å«é€€æ¬¾)
            const refundMultiplier = 1 - (refundRate / 100);
            const effectiveMarginRaw = grossMarginRaw * refundMultiplier; 
            const breakEvenRoiWithRef = effectiveMarginRaw > 0 ? 1 / effectiveMarginRaw : 0;

            // æ•´ä½“ç›ˆäº
            const realGmv = adGmv * refundMultiplier;
            const totalGrossProfit = realGmv * grossMarginRaw;
            const netProfit = totalGrossProfit - adCost;
            const netProfitRate = adGmv > 0 ? (netProfit / adGmv) * 100 : 0;

            // ç›ˆäºå¹³è¡¡è½¬åŒ–ç‡
            const beConvRate = avgTicket > 0 ? (breakEvenRoiWithRef * ppc) / avgTicket * 100 : 0;

            // 3. æ›´æ–°UI
            setHtml('realRoi', realRoi.toFixed(2));
            setHtml('breakEvenRoi', breakEvenRoiWithRef.toFixed(2));
            setHtml('miniRoiDisplay', realRoi.toFixed(2));
            setHtml('grossMargin', (grossMarginRaw * 100).toFixed(1) + '%');
            setHtml('beConvRate', beConvRate.toFixed(2) + '%');
            
            const profitEl = document.getElementById('netProfit');
            const statusEl = document.getElementById('statusAlert');
            
            profitEl.innerText = `Â¥ ${netProfit.toFixed(2)}`;
            setHtml('profitRate', `å‡€åˆ©ç‡: ${netProfitRate.toFixed(2)}%`);

            const profitDiff = realRoi - breakEvenRoiWithRef;

            if (netProfit >= 0) {
                // ç›ˆåˆ©
                profitEl.className = "text-4xl font-black tracking-tight text-green-600";
                statusEl.className = "bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg text-sm font-medium flex items-start gap-3 mb-4";
                
                let winMsg = "å¤„äºç›ˆåˆ©çŠ¶æ€ã€‚ä½†è®°ä½ï¼Œç”µå•†æ²¡æœ‰æ°¸è¿œçš„èµ¢å®¶ï¼Œåªæœ‰æ°¸è¿œçš„ä¼˜åŒ–ã€‚";
                if(profitDiff < 0.5) winMsg = "è™½ç„¶èµšäº†ï¼Œä½†å¾ˆå¾®è–„ã€‚ç¨å¾®é€€è´§å¤šä¸€ç‚¹ä½ å°±ç™½å¹²äº†ã€‚è­¦æƒ•ï¼";
                
                statusEl.innerHTML = `<i class="fas fa-check-circle mt-0.5 text-lg text-green-600"></i> <span>${winMsg}</span>`;
            } else {
                // äºæŸ
                profitEl.className = "text-4xl font-black tracking-tight text-red-600";
                statusEl.className = "bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg text-sm font-medium flex items-start gap-3 mb-4";
                
                let loseMsg = "ä½ åœ¨ç»™å¹³å°åšæ…ˆå–„å—ï¼Ÿæ¯å‡ºä¸€å•éƒ½åœ¨äºé’±ï¼Œèµ¶ç´§åœä¸‹æ¥å¤ç›˜ï¼";
                if(profitDiff > -0.5) loseMsg = "åœ¨äºæŸè¾¹ç¼˜è¯•æ¢ã€‚è¦ä¹ˆé™PPCï¼Œè¦ä¹ˆæè½¬åŒ–ï¼Œåˆ«æ— ä»–è·¯ã€‚";
                
                statusEl.innerHTML = `<i class="fas fa-skull mt-0.5 text-lg text-red-600"></i> <span>${loseMsg}</span>`;
            }

            // æ›´æ–°è¯Šæ–­
            updateDiagnosis(netProfit, realRoi, breakEvenRoiWithRef, ppc, avgTicket, adGmv, adCost);

            // 4. æ›´æ–°æ¡å½¢å›¾
            if (adGmv > 0) {
                const costRatio = (productCost / sellingPrice) * 100;
                const feeRatio = (platformFeeRate + refundRate); 
                const adRatio = (adCost / adGmv) * 100;
                
                let renderCost = costRatio;
                let renderFee = feeRatio;
                let renderAd = adRatio;
                let renderProfit = 100 - renderCost - renderFee - renderAd;
                
                if (renderProfit < 0) {
                    renderProfit = 0; 
                }

                // ç®€å•çš„è§†è§‰ä¿®æ­£ï¼Œé˜²æ­¢æ€»å’Œæº¢å‡ºå¯¼è‡´æ¢è¡Œ
                const total = renderCost + renderFee + renderAd + renderProfit;
                const scale = total > 100 ? 100 / total : 1;

                document.getElementById('barCost').style.width = `${renderCost * scale}%`;
                document.getElementById('barCost').innerText = renderCost > 5 ? `è´§${Math.round(renderCost)}%` : '';
                
                document.getElementById('barFee').style.width = `${renderFee * scale}%`;
                document.getElementById('barFee').innerText = renderFee > 5 ? `æŸ${Math.round(renderFee)}%` : '';

                document.getElementById('barAd').style.width = `${renderAd * scale}%`;
                document.getElementById('barAd').innerText = renderAd > 5 ? `å¹¿${Math.round(renderAd)}%` : '';
                
                document.getElementById('barProfit').style.width = `${renderProfit * scale}%`;
                document.getElementById('barProfit').className = renderProfit > 0 ? 'bar-segment bg-green-500 text-center' : 'hidden';
                document.getElementById('barProfit').innerText = renderProfit > 5 ? `åˆ©${Math.round(renderProfit)}%` : '';
            }
        }

        function updateDiagnosis(netProfit, realRoi, beRoi, ppc, avgTicket, adGmv, adCost) {
            const diagBox = document.getElementById('diagnosisBox');
            let html = '';
            
            const clicks = ppc > 0 ? adCost / ppc : 0;
            const orders = avgTicket > 0 ? adGmv / avgTicket : 0;
            const currentCvr = clicks > 0 ? (orders / clicks * 100) : 0;

            if (netProfit >= 0) {
                const scalePpc = (avgTicket * currentCvr / 100) / beRoi;
                html = `
                    <div class="space-y-3">
                        <div class="flex items-start gap-2">
                            <i class="fas fa-check text-green-600 mt-1"></i>
                            <div>
                                <span class="font-bold text-gray-800">ç°çŠ¶ä¸é”™ï¼š</span>
                                <span class="text-gray-600">ä½†åˆ«èººå¹³ã€‚ç”µå•†æ˜¯é€†æ°´è¡ŒèˆŸï¼Œä½ çš„ROIåªè¦è·Œç ´ <span class="font-bold text-red-600">${beRoi.toFixed(2)}</span>ï¼Œåˆ©æ¶¦ç¬é—´æ¸…é›¶ã€‚</span>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                             <i class="fas fa-bolt text-yellow-600 mt-1"></i>
                             <div>
                                <span class="font-bold text-gray-800">æ¿€è¿›æ‰“æ³•ï¼š</span>
                                <span class="text-gray-600">æƒ³æŠ¢æµé‡ï¼Ÿä½ çš„PPCå¦‚æœæ•¢å‡ºåˆ° <span class="font-bold text-gray-800">Â¥${scalePpc.toFixed(2)}</span>ï¼Œé‚£ä½ å°±çº¯ç²¹æ˜¯åœ¨å¸®å¹³å°æ‰“å·¥äº†ï¼ˆ0åˆ©æ¶¦ç‚¹ï¼‰ã€‚è‡ªå·±æ‚é‡ã€‚</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const targetPpc = (avgTicket * currentCvr / 100) / beRoi;
                const targetCvr = (beRoi * ppc) / avgTicket * 100;

                html = `
                    <div class="space-y-3">
                        <div class="flex items-start gap-2 text-red-700 bg-red-50 p-2 rounded">
                            <i class="fas fa-fire mt-1"></i>
                            <div>
                                <span class="font-bold">ä¸¥é‡è­¦å‘Šï¼š</span>
                                <span>è½¬åŒ–ç‡åªæœ‰ <span class="font-black">${currentCvr.toFixed(2)}%</span>ï¼Œè¿™ç§å†…åŠŸä½ å‡­ä»€ä¹ˆæ•¢å‡ºä»· Â¥${ppc}ï¼Ÿé’±æ˜¯å¤§é£åˆ®æ¥çš„å—ï¼Ÿ</span>
                            </div>
                        </div>
                        <p class="font-bold text-gray-800 text-xs uppercase tracking-wider mt-2">æ­¢è¡€æ–¹æ¡ˆ (äºŒé€‰ä¸€):</p>
                        <ul class="space-y-2 text-gray-700 pl-1">
                            <li class="flex items-center gap-2">
                                <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-1.5 py-0.5 rounded">è®¤æ€‚</span>
                                <span>æŠŠå‡ºä»·é™åˆ° <span class="font-bold text-red-600 border-b border-red-300">Â¥${targetPpc.toFixed(2)}</span>ï¼Œæ¥å—æµé‡å˜å°‘çš„äº‹å®ã€‚</span>
                            </li>
                            <li class="flex items-center gap-2">
                                <span class="bg-indigo-100 text-indigo-700 text-xs font-bold px-1.5 py-0.5 rounded">æ­»ç£•</span>
                                <span>ä¼˜åŒ–ä¸»å›¾å’Œè¯¦æƒ…é¡µï¼ŒæŠŠè½¬åŒ–ç‡æ‹‰åˆ° <span class="font-bold text-red-600 border-b border-red-300">${targetCvr.toFixed(2)}%</span>ã€‚åšä¸åˆ°å°±åˆ«æŠ•äº†ã€‚</span>
                            </li>
                        </ul>
                    </div>
                `;
            }
            
            diagBox.innerHTML = html;
        }

        function copyReport() {
            const date = new Date().toLocaleDateString();
            const netProfit = document.getElementById('netProfit').innerText;
            const roi = document.getElementById('realRoi').innerText;
            const beRoi = document.getElementById('breakEvenRoi').innerText;
            const margin = document.getElementById('grossMargin').innerText;
            
            // æ›´æ¯’èˆŒçš„æˆ˜æŠ¥æ–‡æ¡ˆ
            const isLoss = netProfit.includes('Â¥ -');
            const statusEmoji = isLoss ? 'ğŸ’¸' : 'ğŸ’°';
            const statusText = isLoss ? 'è¡€äº' : 'ç›ˆåˆ©';
            const advice = isLoss 
                ? 'å»ºè®®ï¼šåˆ«è§£é‡Šäº†ï¼Œè¿™å°±æ˜¯äº‹æ•…ã€‚èµ¶ç´§é™PPCæˆ–è€…ä¼˜åŒ–è½¬åŒ–ç‡ï¼Œå¦åˆ™è¶æ—©å…³åº—ã€‚' 
                : 'å»ºè®®ï¼šç›®å‰è¿˜è¡Œï¼Œä½†åˆ«é£˜ã€‚ç»§ç»­ç›‘æ§è½¬åŒ–ç‡æ³¢åŠ¨ï¼Œéšæ—¶å‡†å¤‡è°ƒæ•´å‡ºä»·ã€‚';

            const text = `ã€å¼ å‘è´¢çš„ROIæ¯’èˆŒè¯Šæ–­ã€‘${date}\n------------------\n${statusEmoji} æŠ•æ”¾ç»“æœï¼š${statusText} ${netProfit}\nğŸ“ˆ å®é™…ROIï¼š${roi}\nğŸ›¡ï¸ ç”Ÿæ­»çº¿ROIï¼š${beRoi}\nğŸ“¦ çœŸå®æ¯›åˆ©ï¼š${margin}\n------------------\n${advice}\n(æ¥è‡ªï¼šå¼ å‘è´¢çš„èµ„æ–™åº“)`;

            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showToast();
            } catch (err) {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æˆªå›¾');
            }
            document.body.removeChild(textarea);
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.style.opacity = '1';
            toast.style.transform = 'translate(-50%, 0)';
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translate(-50%, 40px)';
            }, 2500);
        }

        function resetForm() {
            if(confirm('æƒ³æ¸…æ¥šäº†ï¼Ÿæ•°æ®æ¸…ç©ºäº†å¯å›ä¸æ¥ã€‚')) {
                document.querySelectorAll('input').forEach(input => {
                    if(input.id === 'adCost') input.value = 0;
                    if(input.id === 'adGmv') input.value = 0;
                });
                calc();
            }
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            setRandomQuote();
            calc();
        };
    </script>
</body>
</html>
